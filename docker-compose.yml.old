version: '3'

app:
  image: 307749492709.dkr.ecr.us-east-1.amazonaws.com/catalog_app:1.0.0
  restart: always
  build: ./app
  expose:
    - "8000"
  links:
    - postgres:postgres
  volumes:
    - ./app:/app
  env_file: .env
  command: /usr/local/bin/gunicorn app.wsgi -w 2 -b :8000

nginx:
  image: 307749492709.dkr.ecr.us-east-1.amazonaws.com/catalog_nginx:1.0.0
  restart: always
  build: ./nginx
  ports:
    - "80:80"
  volumes:
    - ./app/catalog/static:/usr/share/nginx/html/static
  links:
    - app:app

postgres:
  restart: always
  image: postgres:latest
  ports:
    - "5432:5432"
  #volumes:
  #  - /home/sju/django/data:/var/lib/postgresql/data/
  env_file: .postgres_env

